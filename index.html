<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa Electoral</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Crear el mapa
    const map = L.map('map').setView([-32.95, -60.65], 8); // Rosario como ejemplo

    // Capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Asignar colores seg√∫n el ganador
    function colorPorGanador(ganador) {
      switch (ganador) {
        case 'AGUST√çN ANDRES PELLEGRINI': return '#613583';
        case 'CAREN ESTEFANIA TEPP': return '#4c87e5';
        case 'GISELA SCAGLIA': return '#e66100';
        case 'OTROS': return '#9e9e9e';
        default: return '#cccccc';
      }
    }

    // Escalar transparencia seg√∫n participaci√≥n (de 0.3 a 1)
    function opacidadPorComodidad(p) {
      if (!p) return 0.5;
      let val = parseFloat(p.toString().replace(',', '.')); // por si viene como "0,65"
      //val = Math.min(Math.max(val, 0), 1); // limitar entre 0 y 1
      return 0.2 + 1 * val;
    }

    function getPopupContent(props) {
        const candidatos = [
            { nombre: "Fuerza Patria", color: "üü¶", porcentaje: parseFloat(props["FUERZA PATRIA"]) },
            { nombre: "La Libertad Avanza", color: "üü™", porcentaje: parseFloat(props["LA LIBERTAD AVANZA"]) },
            { nombre: "Provincias Unidas", color: "üüß", porcentaje: parseFloat(props["PROVINCIAS UNIDAS"]) },
        ];

        candidatos.sort((a, b) => b.porcentaje - a.porcentaje);

        return candidatos.map(c => 
            `<div>${c.color} ${c.nombre}: ${c.porcentaje.toFixed(2)}%</div>`
        ).join("");
    }

    // Cargar GeoJSON exportado desde QGIS
    fetch('mapa_resultados.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: feature => ({
            color: '#000', // borde negro
            weight: 0.5,
            fillColor: colorPorGanador(feature.properties.ganador),
            fillOpacity: opacidadPorComodidad(feature.properties.comodidad_n)
          }),
          onEachFeature: (feature, layer) => {
            layer.bindPopup(`
              <b>Circuito: ${feature.properties.circuito_n}</b><br>
              Localidad: ${feature.properties.cabecera}<br>
              Electores: ${feature.properties.electores_n}<br>
              Participaci√≥n: ${parseFloat(feature.properties.participacion_n).toFixed(2)}%<br><br>
              ${getPopupContent(feature.properties)}
            `);
          }
        }).addTo(map);
      });
  </script>
</body>
</html>
